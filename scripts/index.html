<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generar PDF con QR</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.16.0/pdf-lib.min.js"></script>
</head>
<body>
    <form id="qrForm">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" name="nombre" required><br><br>
        
        <label for="apellido">Apellido:</label>
        <input type="text" id="apellido" name="apellido" required><br><br>
        
        <label for="email">Correo:</label>
        <input type="email" id="email" name="email" required><br><br>
        
        <label for="phone">Teléfono:</label>
        <input type="tel" id="phone" name="phone" required><br><br>
        
        <button type="button" onclick="generatePDF()">Generar PDF</button>
    </form>
    
    <script>
        async function generatePDF() {
            const nombre = document.getElementById('nombre').value;
            const apellido = document.getElementById('apellido').value;
            const correo = document.getElementById('email').value;
            const telefono = document.getElementById('phone').value;
            const qrData = `Nombre: ${nombre}, Apellido: ${apellido}, Correo: ${correo}, Teléfono: ${telefono}`;

            const qrCanvas = document.createElement('canvas');
            await QRCode.toCanvas(qrCanvas, qrData, { scale: 3 });

            const pdfDoc = await PDFLib.PDFDocument.create();
            const page = pdfDoc.addPage([500, 500]);

            const logoUrl = '../assets/zeyco_logo.png';
          const logoImageBytes = await fetch(logoUrl).then(res => res.arrayBuffer());
          const logoImage = await pdfDoc.embedPng(logoImageBytes);
          const logoDims = logoImage.scale(0.5);
      
          page.drawImage(logoImage, {
            x: 20,
            y: page.getHeight() - logoDims.height - 20,
            width: logoDims.width,
            height: logoDims.height,
        });
      
          page.drawText(`Nombre: ${nombre}`, { x: 20, y: page.getHeight() - logoDims.height - 60, size: 15 });
          page.drawText(`Apellido: ${apellido}`, { x: 20, y: page.getHeight() - logoDims.height - 80, size: 15 });
          page.drawText(`Correo: ${correo}`, { x: 20, y: page.getHeight() - logoDims.height - 100, size: 15 });
          page.drawText(`Teléfono: ${telefono}`, { x: 20, y: page.getHeight() - logoDims.height - 120, size: 15 });
      
          const qrImage = await pdfDoc.embedPng(qrCanvas.toDataURL('image/png'));
            const qrSize = 150;
            page.drawImage(qrImage, {
                x: (page.getWidth() - qrSize) - 50,
                y: page.getHeight() - logoDims.height - 170,
                width: qrSize,
                height: qrSize,
            });

            const pdfBytes = await pdfDoc.save();
            const pdfBlob = new Blob([pdfBytes], { type: 'application/pdf' });
            const pdfUrl = URL.createObjectURL(pdfBlob);

            const pdfLink = document.createElement('a');
            pdfLink.href = pdfUrl;
            pdfLink.download = 'codigo_qr.pdf';
            pdfLink.textContent = 'Haz clic aquí para descargar el PDF';
            document.body.appendChild(pdfLink);

            if (pdfBlob.size > 5000000) {
                alert('El PDF generado es demasiado grande para ser enviado por correo.');
                return;
            }

            const reader = new FileReader();
            reader.readAsDataURL(pdfBlob);
            reader.onloadend = function() {
                const base64data = reader.result.split(',')[1];
                // Aquí puedes manejar el base64data si lo necesitas para enviar por correo u otros usos.
            }
        }
    </script>
</body>
</html>
